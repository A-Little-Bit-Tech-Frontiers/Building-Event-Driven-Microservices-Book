# 이벤트 기반 처리 기본

대부분의 이벤트 기반 마이크로 서비스는 적어도 다음 세 단계를 거쳐 실행된다.

1. 입력 이벤트 스트림에서 이벤트를 소비
2. 이벤트를 처리
3. 필요한 출력 이벤트를 생산

## 상태 비저장 토폴로지 구성

**마이크로서비스 토폴로지**는 이벤트에 수행하는 일련의 작업들이고, 비즈니스 로직 수행에 필요한 필터, 라우터, 변환, 구체화, 취합같은 기능을 선택해야 한다.

<img width="728" alt="스크린샷 2024-05-21 오후 8 52 49" src="https://github.com/A-Little-Bit-Tech-Frontiers/Building-Event-Driven-Microservices-Book/assets/87420630/1943e30b-6bf0-48b4-8534-6f663039815b">

### 변환

변화는 하나의 이벤트를 처리해서 하나 이상의 출력 이벤트를 내는 과정이다.

- 필터
  - 기준을 충족하면 이벤트를 전파. 0개 이상의 이벤트를 낸다.
- 맵
  - 이벤트 키, 값, 아니면 둘 다 변경해서 정확히 1개의 이벤트를 낸다.
- 맵밸류
  - 이벤트 키는 놔두고 값만 변경해서 1개의 이벤트를 낸다.
- 맞춤 변환
  - 맞춤 로직을 적용하여 상태를 조회하고 다른 시스템과 동기 통신을 한다.

<br>

## 이벤트 스트림 리파티션

이벤트 스트리믄 이벤트 키와 이벤트 파티셔너 로직에 의해 파티셔니된다. <br>
이벤트마다 이벤트 파티셔너를 적용하면 이벤트를 기록할 파티셔니 결정된다. <br>
**리파티션**이란 다음 중 하나 이상의 속성을 이용해 새 이벤트 스트림을 생산하는 행위를 말한다.

- 상이한 파티션 수
  - 다운스트림의 병렬도를 높이고자 이벤트 스트림의 파티션 수를 늘리거나 코파티션을 위해 다른 스트림과 파티션 수를 똑같이 맞춘다.
- 상이한 이벤트 키
  - 키가 같은 이벤트는 동일한 파티션으로 배치되도록 이벤트 키를 변경한다.
- 상이한 이벤트 파티셔너
  - 이벤트를 쓸 파티션 선택 로직을 변경한다.

<img width="698" alt="스크린샷 2024-05-21 오후 9 01 00" src="https://github.com/A-Little-Bit-Tech-Frontiers/Building-Event-Driven-Microservices-Book/assets/87420630/ab84eb01-54bf-42fc-a6ef-43d0859acee0">

## 이벤트 스트림 코파티션

**코파티션**은 어떤 이벤트 스트림을 파티션 수와 파티션 어사이너 로직이 동일한 새로운 스트림으로 리파티션하는 것이다. <br>
한 이벤트 스트림의 키 있는 이벤트를 다른 스트림의 이벤트와 같은 장소에 배치할 떄 필요한 작업이다.

<img width="658" alt="스크린샷 2024-05-21 오후 9 02 38" src="https://github.com/A-Little-Bit-Tech-Frontiers/Building-Event-Driven-Microservices-Book/assets/87420630/9c70d92b-10c0-4bf0-8a0a-8c23487494b1">













